window.espni=window.espni||{};espni.disneyOneIDUtils=function($){var api={};api.isLoggedIn=false;api.user={};var conf={loggedIn:false,navGrpItm:".nav_grpitm",navSlide:"nav_slide",activeClass:"active",maxChar:1e3,userInfo:{}};function getConfig(){var hostname=window.location.hostname,path=window.location.pathname,clientId="ESPN-ONESITE.WEB",langPref="en-US",cssOverride="https://secure.espncdn.com/combiner/c?css=disneyid/core.css,disneyid/cricinfo.css",responderPage="https://ssl.espncricinfo.com/disneyid/responder";return{clientId:clientId,langPref:langPref,cssOverride:cssOverride,responderPage:responderPage,blueCookie:!0,initialize:!0}}function initDisneyID(){if(window.DisneyID===undefined){window.setTimeout(initDisneyID,100)}else{$(".nav_grp_usr").show();did=DisneyID.get();did.on("login",updateGuestInfo);did.on("logout",showUserLoggedOut);did.on("init",onInitDisneyID)}}function showUserUpdate(guest){if(guest){var url="http://"+endpoint+"/ci/content/submit/api/update_oneid_user.html";var data={};if(guest.displayName){if(guest.displayName.proposedDisplayName){data.display_name=guest.displayName.proposedDisplayName}}if(guest.profile){if(guest.profile.email){data.email=guest.profile.email}if(guest.profile.firstName){data.username=guest.profile.firstName}}data.swid=conf.userInfo.swid;data.signin_source_id=conf.userInfo.signin_source_id;if($.cookie("espncricinfo_s2")){data.s2_cookie=encodeURIComponent($.cookie("espncricinfo_s2"))}if(conf.userInfo.swid){$.ajax({url:url,data:data,type:"POST",dataType:"jsonp",jsonpCallback:"jsonCallback",success:function(data){}})}}}function updateGuestInfo(guest){if(guest){var username=guest.profile.firstName;var displayName=guest.displayName.displayName;var proposedDisplayName="";if(guest.displayName.proposedDisplayName){proposedDisplayName=guest.displayName.proposedDisplayName}api.user.displayName=displayName;api.user.username=username;api.user.proposedDisplayName=proposedDisplayName;api.user.swid=guest.profile.swid;conf.loggedIn=true;api.isLoggedIn=true;$("#disney_oneid .hide-for-device span").addClass("sp sp_usr");$("#disney_oneid .hide-for-device span").removeClass("nav_login");$("#disney_oneid .hide-for-device span").text("");$(".espni-profile-msg").text("Welcome "+username+"! ");conf.userInfo.swid=guest.profile.swid;if(guest.token.authenticator=="disneyid"){conf.userInfo.signin_source_id=1;api.user.signin_source_id=1}else{conf.userInfo.signin_source_id=5;api.user.signin_source_id=5}loadCommentModule(username,displayName,proposedDisplayName)}}function onInitDisneyID(data){$(".disney_profile").hide();conf.loggedIn=data.loggedIn;enableButtons();data.loggedIn?updateGuestInfo(data.guest):showUserLoggedOut()}function enableButtons(){$("#disney_oneid, #comment-login").off("click").on("click",function(e){e.preventDefault();var navGroupClicked=$(this).parents(conf.navGrpItm);if(!conf.loggedIn){did.launchLogin();$("html, body").removeClass(conf.navSlide);$("#viewport").css({height:"auto",width:"auto"})}else{if(navGroupClicked.hasClass(conf.activeClass)){navGroupClicked.removeClass(conf.activeClass)}else{navGroupClicked.addClass(conf.activeClass)}$(".disney_profile").show()}});$(".espni-edit-profile").on("click",function(){did.launchProfile();$("#disney_oneid").parents(conf.navGrpItm).removeClass(conf.activeClass);if(!isMobile.phone&&!isMobile.tablet){$(".disney_profile").hide()}});$("#edit_displayname").on("click",function(e){e.preventDefault();did.launchDisplayName()});$(".espni-profile-signout").on("click",function(){did.logout();$("html, body").removeClass(conf.navSlide);$("#viewport").css({height:"auto",width:"auto"});$(conf.navGrpItm).removeClass(conf.activeClass)})}function showUserLoggedOut(){conf.loggedIn=false;$("#disney_oneid .hide-for-device span").removeClass("sp sp_usr");$("#disney_oneid .hide-for-device span").addClass("nav_login");$("#disney_oneid .hide-for-device span").text("Log In");if(typeof _CONTENTTYPE!=="undefined"&&(_CONTENTTYPE=="story"||_CONTENTTYPE==="video")){$("#hp-login-form-for-comments .log_msg").text("Login to Post Your Comments");$("#comment-login").show();$(".comment-form-wrap").hide();$("#hp-login-form-for-comments .espni-logged-in-wrap").hide()}else if(typeof _CONTENTTYPE!=="undefined"&&_CONTENTTYPE=="awards"){$("#login-wrapper").show();$("#loggedin-wrapper").hide()}var navGroupClicked=$(".espni-edit-profile").parents(conf.navGrpItm);$(".disney_profile").hide();$(".espni-profile-msg").text("");navGroupClicked.removeClass(conf.activeClass)}function didOn(event,fnc){did.on(event,function(data){try{fnc(data)}catch(e){}})}function appendDisneyScript(){if(document.querySelector('script[src$="/outer/DisneyID.js"]'))return!0;var source="https://cdn.registerdisney.go.com/v2/outer/DisneyID.js";var script=document.createElement("script");script.src=source,script.onload=function(){window.did=DisneyID.get(getConfig()),initDisneyID()},(document.head||document.body).appendChild(script)}function loadCommentModule(username,displayName,proposedDisplayName){if(typeof _CONTENTTYPE!=="undefined"&&(_CONTENTTYPE=="story"||_CONTENTTYPE==="video")){$("#hp-login-form-for-comments .log_msg").text("Post Your Comments");$("#comment-login").hide();$("#hp-login-form-for-comments .espni-logged-in-wrap").show();if(proposedDisplayName.length>0){$("#hp-login-form-for-comments .espni-profile-name").html("Welcome <b>"+username+"!</b>")}else{$("#hp-login-form-for-comments .espni-profile-name span").html("Welcome <b>"+username+"</b>");$("#hp-login-form-for-comments .espni-profile-name i").text(displayName)}$(".comment-form-wrap").show();$(".comment-form").on("submit",function(e){e.preventDefault();$(".comment-submit-btn").prop("disabled",true);submitStoryComment()});initCharCount()}else if(typeof _CONTENTTYPE!=="undefined"&&_CONTENTTYPE=="awards"){$("#login-wrapper").hide();$("#loggedin-wrapper").show();$("#username_field").val(username)}}function submitStoryComment(){var flag=true;var comm_txt=$(".comment-textbox").val();var object_id=$(".comment-form input[name=object_id]").val();var content_type_id=$(".comment-form input[name=content_type_id]").val();var url="http://"+endpoint+"/ci/content/submit/comment/confirm_new.html";if($("li.hys").length>0){var option_val=$("li.hys input[name=comment_type_id]:checked").val();if(typeof option_val==="undefined"){alert("Please select an option");$("li.hys input[name=comment_type_id]").focus();flag=false;return false}else{option_val=parseInt(option_val,10)}}if(comm_txt.length===0||comm_txt.length<25){alert("Please enter minimum of 25 characters.");$(".comment-textbox").focus();$(".comment-submit-btn").prop("disabled",false);flag=false}if(comm_txt.length>1e3){alert("The text size you entered exceeds 1000 characters. Please reduce the text size to 1000 characters.");$(".comment-textbox").focus();$(".comment-submit-btn").prop("disabled",false);flag=false}var data={};data.text=comm_txt;data.comment_type_id=content_type_id;data.object_id=object_id;data.swid=conf.userInfo.swid;data.signin_source_id=conf.userInfo.signin_source_id;if($.cookie("espncricinfo_s2")){data.s2_cookie=encodeURIComponent($.cookie("espncricinfo_s2"))}if(!flag){return false}else{if(conf.userInfo.swid){$.ajax({url:url,data:data,type:"POST",dataType:"jsonp",jsonpCallback:"jsonCallback",success:function(data){$(".comment-submit-btn").prop("disabled",false);if(data.status===1){$(".comment-form").html('<p class="thanks-msg">Thank you for your comment.<br>  It will be moderated by ESPNcricinfo and published soon.</p>')}}})}}}function initCharCount(){$(".comment-form").find("#char-count").text(conf.maxChar);$(".comment-textbox").on("keydown keyup",function(event){countChar(event)});$(".comment-textbox").on("paste",function(event){var timer=window.setTimeout(function(){countChar(event);window.clearTimeout(timer)},200)})}function countChar(){var comm_txt=$(".comment-textbox").val();var charLen=comm_txt.length;var charRemain=conf.maxChar-charLen;if(charLen>=conf.maxChar){$(".comment-textbox").val(comm_txt.substring(0,conf.maxChar))}$(".comment-form").find("#char-count").text(charRemain>=0?charRemain:0)}api.init=function(){appendDisneyScript();$(".comment-form-wrap").hide();$(".comment-tabs-wrap .container-tab").hide();$(".comment-tabs li a").click(function(e){e.preventDefault();var curr_tab=$(this).attr("data-type");$(".comment-tabs li").removeClass("active1");$(".comment-tabs li a").each(function(){if($(this).attr("data-type")===curr_tab){$(this).parent().addClass("active1")}});$(".comment-tabs-wrap .container-tab").hide();var selected_tab=".container-tab."+$(this).attr("data-type");$(selected_tab).fadeIn("fast")});if($(".comment-tabs-wrap").find("ul#featured").size()>0){$(".comment-tabs li").find("a[data-type='featured']").trigger("click")}else{$(".comment-tabs li").find("a[data-type='latest']").trigger("click")}};return api}(jQuery);jQuery(function(){espni.disneyOneIDUtils.init()});