define([
    'ads',

    // Bootstrap code
    'lib/module/manager',
    'lib/core',
    'lib/util',

    // Vendor libraries
    'vendor/bower/fastclick/fastclick'

], function (ads, modules, core, util, FastClick) {

   'use strict';

    return {
        init: function (root, config) {
            core.config = config;

            // Set up advertising
            ads.init(root, root.bbcdotcom);

            // Modernizr seems to report font-face is supported in Opera Mini.
            // Hopefully, this is a work around until we revisit icons
            // We are now also using this to collapse images for Opera Mini
            if (Object.prototype.toString.call(root.operamini) === '[object OperaMini]') {
                core.$('html').addClass('opera-mini');
            }

            root.wwhp = {};
            root.wwhp.core = core;

            modules.load().always(function (modules, failed) {
                root.wwhp.modules = modules;
                root.wwhp.failed = failed;
            });

            FastClick.attach(root.document.body, {});
        }
    };
});